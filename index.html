<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tic-Tac-Toe</title>
  <link rel="stylesheet" href="https://pyscript.net/releases/2025.7.3/core.css" />
  <script type="module" src="https://pyscript.net/releases/2025.7.3/core.js"></script>
  <style>
    #board {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 5px;
    }
    .cell {
      width: 100px;
      height: 100px;
      font-size: 32px;
      text-align: center;
      line-height: 100px;
      border: 1px solid #000;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Tic-Tac-Toe</h1>
    <h2 id="status">Select an Option Below:</h2>
    <div id="mode-box">
      <select id="mode-select">
        <option value="">---Select Mode---</option>
        <option value="pvp">Play against a friend</option>
        <option value="pvc">Play against a CPU</option>
        <option value="scoreboard">See scoreboard</option>
      </select>
      <button id="start-button">Start Game</button>
    </div>
    <div id="player-box">
      <input type="text" id="playerX" placeholder="Enter Player X Name" style="display:none;">
      <input type="text" id="playerO" placeholder="Enter Player O Name" style="display:none;">
      <button id="submit-player-button" style="display:none;">Submit</button>
    </div>
    <button id="play-again-button" style="display:none;">Play Again</button>
    <div id="board">
      <button class="cell" id="cell-0"></button>
      <button class="cell" id="cell-1"></button>
      <button class="cell" id="cell-2"></button>
      <button class="cell" id="cell-3"></button>
      <button class="cell" id="cell-4"></button>
      <button class="cell" id="cell-5"></button>
      <button class="cell" id="cell-6"></button>
      <button class="cell" id="cell-7"></button>
      <button class="cell" id="cell-8"></button>
    </div>
  <script type="py">
    from pyscript import display, when
    from js import document

    board = [""] * 9
    saved_players = {}
    current_player = "X"
    playerX = None
    playerO = None
    game_over = False
    game_started = False
    is_pvp = True

    class Player:
      def __init__(self, name):
        self.name = name
        self.x_score = 0
        self.o_score = 0
        self.draw_count = 0

      def add_xpoint(self):
        self.x_score += 1

      def add_opoint(self):
        self.o_score += 1

      def add_draw(self):
        self.draw_count += 1

      def get_tscore(self):
        return self.x_score + self.o_score
    
    def clear_board():
      global board, current_player, game_over, game_started

      board = [""] * 9
      current_player = "X"
      game_over = False
      game_started = False

      cells = document.getElementsByClassName("cell")
      for i in range(cells.length):
        cells[i].innerText = ""

    @when("click", "#play-again-button")
    def play_again():
      clear_board()
      document.getElementById("play-again-button").style.display = "none"
      document.getElementById("status").innerText = "Select an Option Below:"
      document.getElementById("mode-box").style.display = "block"

    @when("click", "#board button")
    def handle_click(event):
      global board, current_player, game_over, game_started, is_pvp

      status = document.getElementById("status")

      if not game_started:
        return

      if game_over:
        return

      cell_id = int(event.target.id.split("-")[1])
      if board[cell_id] != "":
        return

      board[cell_id] = current_player
      event.target.innerText = current_player

      winner = check_win()
      if winner:
        game_over = True
        document.getElementById("play-again-button").style.display = "block"
        if winner == "Draw":
          status.innerText = "It's a draw!"
        else:
          status.innerText = f"{winner} wins!"
      else:
        current_player = "O" if current_player == "X" else "X"
        status.innerText = f"{current_player}'s turn"

        if not is_pvp:
          cpu_move()

    def check_win():
      win_conditions = [
        [0, 1, 2],
        [3, 4, 5],
        [6, 7, 8],
        [0, 3, 6],
        [1, 4, 7],
        [2, 5, 8],
        [0, 4, 8],
        [2, 4, 6]
      ]

      for a, b, c in win_conditions:
        if board[a] == board[b] == board[c] and board[a] in ('X', 'O'):
          return board[a]

      if "" not in board:
        return "Draw"

      return None
    
    def prompt_pvp():
      document.getElementById("status").innerText = "Enter Your Usernames:"
      document.getElementById("mode-box").style.display = "none"
      document.getElementById("player-box").style.display = "block"
      document.getElementById("playerX").style.display = "inline"
      document.getElementById("playerO").style.display = "inline"
      document.getElementById("submit-player-button").style.display = "block"
      return
    
    @when("click", "#submit-player-button")
    def save_players(event):
      global game_started
      mode = document.getElementById("mode-select").value
      
      # TO-DO player saving

      document.getElementById("player-box").style.display = "none"
      document.getElementById("status").innerText = "X's turn"
      game_started = True

    @when("click", "#start-button")
    def start_game(event):
      global game_started, is_pvp
      mode = document.getElementById("mode-select").value
      
      if mode == "pvp":
        is_pvp = True
        prompt_pvp()
      elif mode == "pvc":
        is_pvp = False
        game_started = True
        document.getElementById("mode-box").style.display = "none"
        prompt_pvc()
      elif mode == "scoreboard":
        show_scoreboard()
      else:
        document.getElementById("status").innerText = "Please Select a Valid Mode:"
        return

</script>
</body>
</html>